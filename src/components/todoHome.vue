<template>
  <div class="home-page__card">
    <h2 class="home-page__card-title">Get Things Done!</h2>
    <div class="home-page__card-button-wrapper">
      <v-btn class="home-page__card-button" to="/task">+ New Task</v-btn>
    </div>
    <div class="home-page__card-task-scroll">
      <div v-for="task in taskStore.tasks" :key="task.id" class="home-page__card-items">
        <div class="home-page__card-contents">
          <v-checkbox
            class="home-page__card-checkbox"
            v-model="task.completed"
            @change="taskCompleted(task)"
          />
          <div :class="{ completed: task.completed }">
            <v-tooltip location="top">
              <template v-slot:activator="{ props }">
                <div class="home-page__card-task-name" v-bind="props">Task: {{ task.name }}</div>
              </template>
              <span class="home-page__card-tooltip-text">Task: {{ task.name }}</span>
            </v-tooltip>
            <div>Estimate Time: {{ task.estimatedTime }}</div>
          </div>
        </div>
        <div class="home-page__card-edit-delete-svg">
          <svg
            @click="handleEdit(task)"
            xmlns="http://www.w3.org/2000/svg"
            class="home-page__card-icon"
            height="20"
            width="20"
            viewBox="0 0 24 24"
            fill="white"
          >
            <path
              d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41L18.37 3.29a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"
            />
          </svg>
          <svg
            @click="deleteTask(task.id)"
            xmlns="http://www.w3.org/2000/svg"
            class="home-page__card-icon"
            height="20"
            width="20"
            viewBox="0 0 24 24"
            fill="white"
          >
            <path
              d="M16 9v10H8V9h8m-1.5-6H9.5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"
            />
          </svg>
        </div>
      </div>
    </div>
    <div class="home-page__card-button-wrapper">
      <v-btn class="home-page__card-delete-button" @click="deleteAllTasks()">Delete All</v-btn>
    </div>
  </div>
</template>

<script setup lang="ts">
import { onMounted } from "vue";
import { useRouter } from "vue-router";
import { useTaskStore } from "@/stores/task";
import type { Task } from "@/type/home";

const taskStore = useTaskStore();
const router = useRouter();

const handleEdit = (task: Task) => {
  taskStore.taskToEdit = task;
  router.push("/edit");
};

const taskCompleted = async (task: Task) => {
  await taskStore.updateCompleted(task);
};

const deleteTask = async (taskId: string) => {
  await taskStore.deleteTask(taskId);
};

const deleteAllTasks = async () => {
  await taskStore.deleteAllTasks();
};

onMounted(() => {
  taskStore.fetchTasks();
});
</script>

<style lang="scss" scoped>
.home-page__card {
  background-color: #1e1e2f;
  padding: 24px;
  border-radius: 16px;
  width: 100%;
  max-width: 600px;

  &-title {
    text-align: center;
    color: white;
    margin-bottom: 24px;
  }

  &-button-wrapper {
    width: 130px;
    margin-inline: auto;
    margin-bottom: 24px;
    margin-top: 24px;
  }

  &-button {
    background-color: #a259ff;
    color: white;
    font-size: 16px;
    text-decoration: none;
  }

  &-task-scroll {
    max-height: 320px;
    overflow-y: auto;
    margin-bottom: 24px;
    scrollbar-width: none;
  }
  &-items {
    background-color: #a259ff;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
    padding: 12px 16px;
    border-radius: 8px;
  }

  &-contents {
    display: flex;
    align-items: center;
  }

  &-checkbox {
    margin-right: 12px;
  }

  &-task-name {
    max-width: 400px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  @media only screen and (max-width: 600px) {
    &-task-name {
      max-width: 142px !important;
    }
  }

  &-tooltip-text {
    max-width: 400px;
    white-space: normal;
    word-wrap: break-word;
    display: inline-block;
  }
  &-edit-delete-svg {
    display: flex;
  }

  &-icon {
    margin-left: 12px;
    cursor: pointer;
  }

  &-delete-button {
    background-color: #ff4d4d;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 14px;
  }
}

.completed {
  text-decoration: line-through;
}

::v-deep(.v-input__details) {
  grid-area: unset !important;
}
::v-deep(.v-checkbox .v-selection-control) {
  min-height: unset !important;
}
</style>
